(this.webpackJsonpmedicus=this.webpackJsonpmedicus||[]).push([[11],{131:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return S}));var c=n(0),a=n(12),s=n.n(a),r=n(14),i=n(8),o=n(99),l=n(13),u=n(19),d=n(54),b=n(15),j=n(11),h=n(51),m=n(33),p=n(1);function f(e){var t=Object(c.useRef)(null),n=Object(c.useState)({messages:[],limit:10}),a=Object(i.a)(n,2),o=a[0],d=a[1];function f(){return(f=Object(r.a)(s.a.mark((function t(){var n,c,a,r,i;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!e.chat){t.next=16;break}return n="/api/chats/".concat(e.chat.id,"/messages"),(c=new URLSearchParams).append("page",Math.ceil(o.messages.length/o.limit)),c.append("limit",o.limit),t.next=8,fetch("".concat(n,"?").concat(c.toString()),{headers:{Authorization:"Bearer ".concat(e.session.authToken)}});case 8:return a=t.sent,t.next=11,a.json();case 11:if(r=t.sent,a.ok){t.next=14;break}throw new Error(r.message);case 14:i=r.reverse(),d((function(e){var t=[].concat(Object(h.a)(i),Object(h.a)(e.messages));return Object(j.a)(Object(j.a)({},e),{},{messages:t})}));case 16:t.next=21;break;case 18:t.prev=18,t.t0=t.catch(0),console.error("Failed to append chat messages. ".concat(t.t0));case 21:case"end":return t.stop()}}),t,null,[[0,18]])})))).apply(this,arguments)}Object(c.useEffect)((function(){var n=t.current;function c(){return(c=Object(r.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{d((function(e){var n=[].concat(Object(h.a)(e.messages),[t]);return Object(j.a)(Object(j.a)({},e),{},{messages:n})})),n.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})}catch(c){console.error("Failed to receive chat message from server. ".concat(c))}case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}e.channel&&e.channel.on("chat",(function(e){return c.apply(this,arguments)}))}),[e.channel]);var O,x=null,g="",v=[],y=Object(b.a)(o.messages.entries());try{for(y.s();!(O=y.n()).done;){var N=Object(i.a)(O.value,2),w=N[0],k=N[1],S=new Date(k.timestamp);if(!x||x.toDateString()!==S.toDateString()){var C=Object(p.jsx)(l.g,{className:"justify-content-center mt-3",children:Object(p.jsx)(l.a,{className:"col-auto md-chat-sys",children:Object(p.jsx)("p",{className:"md-font-sm my-0 text-muted",children:Object(p.jsx)(m.g,{date:S})})})},"date-".concat(w));v.push(C),x=S,g=""}var F=k.sender,D=e.session.username===F,B=D?"justify-content-end":"justify-content-start",E=D?"md-chat-out":"md-chat-in",I=g===F?"mt-1":"mt-3",L=Object(p.jsx)(l.g,{className:"".concat(B," ").concat(I),children:Object(p.jsx)(l.a,{className:"col-10",children:Object(p.jsx)(l.g,{className:B,children:Object(p.jsxs)(l.e,{className:"md-chat-msg ".concat(E," mx-2 p-2"),children:[Object(p.jsx)("p",{className:"my-0",children:k.content}),Object(p.jsx)("footer",{className:"d-flex justify-content-end",children:Object(p.jsx)("p",{className:"my-0 md-font-xs text-muted",children:Object(p.jsx)(m.c,{date:S})})})]})})})},w);v.push(L),g=F}}catch(T){y.e(T)}finally{y.f()}return Object(p.jsx)(l.g,{className:"md-msg-window flex-grow-1 overflow-y border-top border-bottom",children:Object(p.jsxs)(l.a,{children:[Object(p.jsx)(u.a,{callback:function(){return f.apply(this,arguments)}}),v,Object(p.jsx)("span",{ref:t,className:"p-1"})]})})}var O=n(32),x=n(52),g=n(55),v=n(23);function y(e){var t=Object(c.useState)({content:""}),n=Object(i.a)(t,2),a=n[0],o=n[1];function l(){return(l=Object(r.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o(Object(j.a)(Object(j.a)({},a),{},Object(O.a)({},t.target.name,t.target.value)));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function u(){return(u=Object(r.a)(s.a.mark((function t(n){var c;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),t.prev=1,c=new Date,t.next=5,e.channel.emit("chat",{chatId:e.chat.id,sender:Object(v.m)({user:e.session}),timestamp:c,content:a.content});case 5:o(Object(j.a)(Object(j.a)({},a),{},{content:""})),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(1),console.error("Failed to send chat message. ".concat(t.t0));case 11:case"end":return t.stop()}}),t,null,[[1,8]])})))).apply(this,arguments)}return Object(p.jsx)(x.a,{autoComplete:"off",handleSubmit:function(e){return u.apply(this,arguments)},children:Object(p.jsxs)(x.f,{children:[Object(p.jsx)(x.c,{className:"col my-2",children:Object(p.jsx)("input",{type:"text",name:"content","aria-label":"Input chat message",className:"form-control",value:a.content,onChange:function(e){return l.apply(this,arguments)},placeholder:"",disabled:e.isDisabled})}),Object(p.jsx)(x.c,{className:"col-auto my-2",children:Object(p.jsx)(x.b,{type:"submit",className:"md-btn p-2 d-flex align-items-center",disabled:e.isDisabled,children:Object(p.jsx)(g.a,{children:"send"})})})]})})}function N(e){return Object(p.jsx)(l.f,{className:"md-sbar p-2 justify-content-center",children:Object(p.jsx)(l.a,{children:Object(p.jsx)(y,{session:e.session,chat:e.chat,channel:e.channel})})})}function w(e){var t=Object(c.useState)(null),n=Object(i.a)(t,2),a=n[0],b=n[1];return Object(c.useEffect)((function(){function t(){return n.apply(this,arguments)}function n(){return(n=Object(r.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{a&&!a.connected&&c()}catch(t){console.error("Failed to reconnect to server. ".concat(t))}case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function c(){return i.apply(this,arguments)}function i(){return(i=Object(r.a)(s.a.mark((function n(){var c;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:try{(c=Object(o.io)()).on("connect",(function(){console.debug("Channel connection status: ".concat(c.connected)),console.log("Connected to server.")})),c.on("disconnect",t),c.emit("join",{chatId:e.chat.id},(function(e){"ok"===e.status?console.debug("Joined chat session."):console.log("Failed to join chat session.")})),b(c)}catch(a){console.error("Failed to connect to server. ".concat(a))}case 1:case"end":return n.stop()}}),n)})))).apply(this,arguments)}return c(),function(){function t(){return(t=Object(r.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:try{a&&(a.emit("leave",{chatId:e.chat.id},(function(e){"ok"===e.status?console.debug("Left chat session."):console.log("Failed to leave chat session.")})),a.close(),console.debug("Channel connection status: ".concat(a.connected))),console.log("Disconnected from server."),b(null)}catch(n){console.error("Failed to disconnect from server. ".concat(n))}case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}}),[e.chat]),Object(p.jsx)(l.e,{className:"d-flex flex-column md-chat h-100 px-0",children:e.isLoading?Object(p.jsx)(p.Fragment,{children:Object(p.jsx)(u.b,{isLoading:!0})}):Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(d.d,{title:e.chat.title,children:Object(p.jsx)(d.b,{children:Object(p.jsx)(d.a,{path:"/appointments/".concat(e.chat.appointmentId),title:"Go to Appointment",icon:"event"})})}),Object(p.jsx)(f,{session:e.session,chat:e.chat,channel:a}),Object(p.jsx)(N,{session:e.session,chat:e.chat,channel:a})]})})}function k(e){var t=Object(c.useState)(!0),n=Object(i.a)(t,2),a=n[0],o=n[1],l=Object(c.useState)({}),u=Object(i.a)(l,2),d=u[0],b=u[1];return Object(c.useEffect)((function(){function t(){return(t=Object(r.a)(s.a.mark((function t(){var n,c;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,o(!0),t.next=4,fetch("/api/chats/".concat(e.id),{credentials:"same-origin",headers:{Authorization:"Bearer ".concat(e.session.authToken)}});case 4:return n=t.sent,t.next=7,n.json();case 7:if(c=t.sent,n.ok){t.next=10;break}throw new Error(c.message);case 10:b(c),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(0),console.error("Failed to initialize chat- ".concat(e.id,". ").concat(t.t0));case 16:return t.prev=16,o(!1),t.finish(16);case 19:case"end":return t.stop()}}),t,null,[[0,13,16,19]])})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}),[e.id,e.session]),e.listView?null:Object(p.jsx)(w,{session:e.session,chat:d,isLoading:a})}function S(e){return Object(p.jsx)(k,{session:e.session,id:e.id,listView:!1})}},52:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"f",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"b",(function(){return o})),n.d(t,"g",(function(){return l})),n.d(t,"d",(function(){return u})),n.d(t,"e",(function(){return d}));n(0);var c=n(3),a=n(1);function s(e){var t=e.enctype?e.enctype:"application/x-www-form-urlencoded";return Object(a.jsx)("form",{method:"post",autoComplete:e.autoComplete,enctype:t,className:Object(c.b)("",e.className),onSubmit:e.handleSubmit,children:e.children})}function r(e){return Object(a.jsx)("div",{className:Object(c.b)("form-row",e.className),children:e.children})}function i(e){return Object(a.jsx)("div",{className:Object(c.b)("form-group",e.className),children:e.children})}function o(e){return Object(a.jsx)("button",{type:e.type?e.type:"button",disabled:e.disabled,className:Object(c.b)("btn",e.className),onClick:e.handleClick,children:e.children})}function l(e){return Object(a.jsx)(o,{type:"submit",disabled:e.disabled,className:Object(c.b)("btn-primary",e.className),children:e.children})}function u(e){return Object(a.jsx)("label",{htmlFor:e.for,className:Object(c.b)("col-form-label",e.className),children:e.children})}function d(e){return Object(a.jsx)("legend",{htmlFor:e.for,className:Object(c.b)("col-form-label",e.className),children:e.children})}},53:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"d",(function(){return o})),n.d(t,"f",(function(){return l})),n.d(t,"e",(function(){return u}));n(0),n(31);var c=n(3),a=n(1);function s(e){return Object(a.jsx)("div",{className:Object(c.b)("dropdown",e.className),children:e.children})}function r(e){return Object(a.jsx)("button",{type:"button",id:e.id,"data-toggle":"dropdown",className:Object(c.b)("btn",e.className),"aria-haspopup":"true","aria-expanded":"false",children:e.children})}function i(e){return Object(a.jsx)("button",{type:"button",id:e.id,"data-toggle":"dropdown",className:Object(c.b)("btn dropdown-toggle",e.className),"aria-haspopup":"true","aria-expanded":"false",children:e.children})}function o(e){return Object(a.jsx)("div",{"aria-labelledby":e.labelledBy,className:Object(c.b)("dropdown-menu",e.className),children:e.children})}function l(e){return Object(a.jsx)("div",{className:Object(c.b)("dropdown-divider",e.className)})}function u(e){return Object(a.jsx)("button",{type:"button",onClick:e.handleClick,className:Object(c.b)("dropdown-item",e.className),name:e.name,value:e.value,disabled:Boolean(e.disabled),children:e.children})}},54:function(e,t,n){"use strict";n.d(t,"a",(function(){return v})),n.d(t,"b",(function(){return y})),n.d(t,"c",(function(){return N})),n.d(t,"d",(function(){return w}));var c=n(12),a=n.n(c),s=n(32),r=n(14),i=n(8),o=n(11),l=n(49),u=n(0),d=n(24),b=n(3),j=n(1);var h=n(53),m=n(52),p=n(55),f=n(57),O=n(23);function x(e){var t=e.className,n=e.icon,c=Object(l.a)(e,["className","icon"]);return Object(j.jsx)(f.m,Object(o.a)(Object(o.a)({className:Object(b.b)("md-btn p-2 mx-1",t)},c),{},{children:Object(j.jsx)(p.a,{className:"d-flex align-items-center",children:n})}))}function g(e){var t=e.title,n=e.icon,c=Object(l.a)(e,["title","icon"]);return Object(j.jsxs)(f.i,Object(o.a)(Object(o.a)({className:"md-mi d-flex align-items-center"},c),{},{children:[Object(j.jsx)(p.a,{children:n}),Object(j.jsx)("p",{className:"my-0 pl-2 text-truncate",children:t})]}))}function v(e){var t=e.className,n=e.title,c=e.icon,a=Object(l.a)(e,["className","title","icon"]);return Object(j.jsxs)(f.k,Object(o.a)(Object(o.a)({},a),{},{className:Object(b.b)("md-btn mx-1 p-2 d-flex align-items-center",t),tooltip:n,role:"button",children:[Object(j.jsx)(p.a,{children:c}),Object(j.jsx)("p",{className:"my-0 pl-2 text-truncate d-md-none",children:n})]}))}function y(e){return Object(j.jsx)(f.l,{children:e.children})}function N(e){var t=Object(u.useState)({query:""}),n=Object(i.a)(t,2),c=n[0],l=n[1];function d(){return(d=Object(r.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:l(Object(o.a)(Object(o.a)({},c),{},Object(s.a)({},t.target.name,t.target.value)));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(){return(h=Object(r.a)(a.a.mark((function t(n){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.preventDefault();try{e.handleSearch&&e.handleSearch(c.query)}catch(a){console.error("Failed to handle search query. ".concat(a))}case 2:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return Object(j.jsx)(m.a,{handleSubmit:function(e){return h.apply(this,arguments)},className:Object(b.b)("form-inline mx-1 my-2 my-lg-0",e.className),children:Object(j.jsxs)("div",{className:"input-group w-100",children:[Object(j.jsx)("input",{id:"titlebarSearch01",type:"text",className:"form-control",name:"query",placeholder:e.placeholder,value:c.query,onChange:function(e){return d.apply(this,arguments)},"aria-label":"Search Query","aria-describedby":"titlebarSearch02"}),Object(j.jsx)("div",{className:"input-group-append",children:Object(j.jsx)("button",{id:"titlebarSearch02",type:"button",className:"btn btn-sm btn-outline-secondary",children:Object(j.jsx)(p.a,{children:"search"})})})]})})}function w(e){var t=Object(d.c)((function(e){return e.session}));return Object(j.jsxs)(f.b,{className:"navbar-expand-md navbar-light row md-tbar sticky-top justify-content-start",children:[Object(j.jsx)(x,{target:"sideBar01",icon:"menu",toggleType:"modal"}),Object(j.jsx)(f.c,{className:"mr-auto p-1 font-weight-bold",children:e.title}),e.children&&Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)(x,{target:"titleBarNav01",icon:"more_vert"}),Object(j.jsx)(f.d,{id:"titleBarNav01",className:"justify-content-end order-last order-md-4",children:e.children})]}),Object(j.jsxs)(f.a,{className:"order-md-last",asList:!0,children:[Object(j.jsx)(S,{}),Object(j.jsx)(k,{session:t,user:t})]})]})}function k(e){var t=Object(d.b)();function n(){return(n=Object(r.a)(a.a.mark((function n(c){var s,r;return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return c.preventDefault(),n.prev=1,n.next=4,fetch("/api/auth/signout",{method:"GET",credentials:"same-origin",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.session.authToken)}});case 4:return s=n.sent,n.next=7,s.json();case 7:if(r=n.sent,s.ok){n.next=10;break}throw new Error(r.message);case 10:t({type:"session/reset"}),n.next=16;break;case 13:n.prev=13,n.t0=n.catch(1),console.error("Failed to sign out. ".concat(n.t0));case 16:case"end":return n.stop()}}),n,null,[[1,13]])})))).apply(this,arguments)}var c=[{path:"/users/".concat(e.user.username),title:"Profile",icon:"person"},{path:"/settings",title:"Settings",icon:"settings"},{title:"Sign Out",icon:"logout",handleClick:function(e){return n.apply(this,arguments)}}];return Object(j.jsxs)(f.e,{children:[Object(j.jsx)(f.f,{className:"px-0 mx-1 d-flex align-items-center",children:Object(j.jsx)(O.i,{className:"md-pfl-xs md-pfl-round",session:e.session,user:e.user})}),Object(j.jsx)(f.g,{className:"dropdown-menu-right",children:c.map((function(e,t){return Object(j.jsx)(g,{path:e.path,exact:e.exact,title:e.title,icon:e.icon,handleClick:e.handleClick},t)}))})]})}function S(e){return Object(j.jsxs)(f.e,{className:"mx-1 my-2",children:[Object(j.jsx)(h.c,{className:"md-btn p-2 d-flex align-items-center",children:Object(j.jsx)(p.a,{children:"notifications"})}),Object(j.jsx)(f.g,{className:"dropdown-menu-right",children:Object(j.jsx)(f.h,{children:"Coming Soon!"})})]})}}}]);
//# sourceMappingURL=11.b809e883.chunk.js.map