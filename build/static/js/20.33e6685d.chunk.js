(this.webpackJsonpmedicus=this.webpackJsonpmedicus||[]).push([[20],{144:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return w}));var r=n(12),a=n.n(r),c=n(11),s=n(51),o=n(14),i=n(8),p=n(0),l=n(19),u=n(50),j=n(32),d=n(52),b=n(23),h=n(1);function m(e){var t=Object(p.useState)(""),n=Object(i.a)(t,2),r=n[0],s=n[1],l=Object(p.useState)({name:""}),u=Object(i.a)(l,2),m=u[0],f=u[1];function O(){return(O=Object(o.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:f(Object(c.a)(Object(c.a)({},m),{},Object(j.a)({},t.target.name,t.target.value)));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(){return(x=Object(o.a)(a.a.mark((function t(n){var r,o,i;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),t.prev=1,r={fromUsername:Object(b.m)({user:e.session}),name:m.name.replace(/^.*[\\\/]/,""),date:new Date},t.next=5,fetch("/api/appointments/".concat(e.appointment.id,"/labReports"),{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.session.authToken)},body:JSON.stringify(r)});case 5:return o=t.sent,t.next=8,o.json();case 8:if(i=t.sent,o.ok){t.next=11;break}throw new Error(i.message);case 11:r.id=i.id,e.appendReport&&e.appendReport(r),f(Object(c.a)(Object(c.a)({},m),{},{name:""})),t.next=20;break;case 16:t.prev=16,t.t0=t.catch(1),console.error("Failed to add new report. ".concat(t.t0)),s(t.t0.message);case 20:case"end":return t.stop()}}),t,null,[[1,16]])})))).apply(this,arguments)}return Object(h.jsxs)(d.a,{className:"container-fluid",handleSubmit:function(e){return x.apply(this,arguments)},children:[r&&Object(h.jsx)(d.f,{className:"justify-content-center",children:Object(h.jsx)("div",{className:"alert alert-danger",role:"alert",children:r})}),Object(h.jsx)(d.f,{className:"my-2",children:Object(h.jsxs)(d.c,{className:"custom-file",children:[Object(h.jsx)("input",{id:"reportsForm01",type:"file",name:"name",className:"custom-file-input",value:m.name,onChange:function(e){return O.apply(this,arguments)},required:!0}),Object(h.jsx)("label",{className:"custom-file-label",for:"reportsForm01",children:m.name?m.name.replace(/^.*[\\\/]/,""):"Choose a file..."})]})}),Object(h.jsx)(d.f,{className:"my-2 justify-content-center",children:Object(h.jsx)(d.g,{className:"col-auto col-md-4",children:"Upload"})})]})}var f=n(33),O=n(13);function x(e){return Object(h.jsx)(u.l,{children:Object(h.jsx)(O.e,{children:Object(h.jsx)(O.g,{children:Object(h.jsx)(O.a,{className:"md-font-sm text-center text-muted",children:"No report available"})})})})}function v(e){function t(){return(t=Object(o.a)(a.a.mark((function t(n){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.preventDefault(),e.handleDelete&&e.handleDelete(e.report.id);case 2:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var n=e.report.fromUsername,r=Object(b.m)({user:e.session})===n,c=new Date(e.report.date);return Object(h.jsx)(u.l,{children:Object(h.jsx)(O.e,{children:Object(h.jsxs)(O.g,{children:[Object(h.jsx)(O.a,{className:"align-self-center",children:Object(h.jsxs)(O.g,{children:[Object(h.jsx)(O.a,{className:"text-truncate",children:e.report.name}),Object(h.jsx)(O.a,{className:"col-auto",children:Object(h.jsx)(f.f,{date:c})})]})}),Object(h.jsx)(O.a,{className:"col-auto px-2",children:r&&Object(h.jsx)(u.i,{children:Object(h.jsx)(u.j,{handleClick:function(e){return t.apply(this,arguments)},children:"Delete"})})})]})})})}function y(e){return Object(h.jsx)(u.k,{children:0!==e.reports.length?Object(h.jsx)(h.Fragment,{children:e.reports.map((function(t,n){return Object(h.jsx)(v,{session:e.session,report:t,handleDelete:e.deleteReport},n)}))}):Object(h.jsx)(x,{})})}function w(e){var t=Object(p.useState)({reports:[],limit:10}),n=Object(i.a)(t,2),r=n[0],j=n[1];function d(){return(d=Object(o.a)(a.a.mark((function t(){var n,o,i,p;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n="/api/appointments/".concat(e.appointment.id,"/labReports"),(o=new URLSearchParams).append("page",Math.ceil(r.reports.length/r.limit)),o.append("limit",r.limit),t.next=7,fetch("".concat(n,"?").concat(o.toString()),{headers:{Authorization:"Bearer ".concat(e.session.authToken)}});case 7:return i=t.sent,t.next=10,i.json();case 10:if(p=t.sent,i.ok){t.next=13;break}throw new Error(p.message);case 13:j((function(e){var t=[].concat(Object(s.a)(e.reports),Object(s.a)(p));return Object(c.a)(Object(c.a)({},e),{},{reports:t})})),t.next=19;break;case 16:t.prev=16,t.t0=t.catch(0),console.error("Failed to append more reports. ".concat(t.t0));case 19:case"end":return t.stop()}}),t,null,[[0,16]])})))).apply(this,arguments)}function b(){return(b=Object(o.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:j((function(e){var n=[t].concat(Object(s.a)(e.reports));return Object(c.a)(Object(c.a)({},e),{},{reports:n})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(){return(f=Object(o.a)(a.a.mark((function t(n){var s,o;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch("/api/appointments/".concat(e.appointment.id,"/labReports/").concat(n),{method:"DELETE",credentials:"same-origin",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.session.authToken)}});case 3:return s=t.sent,t.next=6,s.json();case 6:if(o=t.sent,s.ok){t.next=9;break}throw new Error(o.message);case 9:j((function(e){var t=r.reports.filter((function(e){return e.id!==n}));return Object(c.a)(Object(c.a)({},e),{},{reports:t})})),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(0),console.error("Failed to delete report- ".concat(n,". ").concat(t.t0));case 15:case"end":return t.stop()}}),t,null,[[0,12]])})))).apply(this,arguments)}return Object(h.jsxs)(h.Fragment,{children:[Object(h.jsxs)(u.e,{children:[Object(h.jsx)(u.a,{title:"Reports",children:Object(h.jsx)(u.d,{target:"apptReportAdd01",expandIcon:"add",collapseIcon:"clear"})}),Object(h.jsx)(u.g,{id:"apptReportAdd01",children:Object(h.jsx)(m,{session:e.session,appointment:e.appointment,appendReport:function(e){return b.apply(this,arguments)}})}),Object(h.jsx)(y,{session:e.session,reports:r.reports,deleteReport:function(e){return f.apply(this,arguments)}})]}),Object(h.jsx)(l.a,{callback:function(){return d.apply(this,arguments)}})]})}},51:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(25);var a=n(20);function c(e){return function(e){if(Array.isArray(e))return Object(r.a)(e)}(e)||function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||Object(a.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}}}]);
//# sourceMappingURL=20.33e6685d.chunk.js.map